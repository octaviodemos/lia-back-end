{
  "openapi": "3.0.0",
  "paths": {
    "/users": {
      "get": {
        "operationId": "UsersController_findAll",
        "summary": "List all users (admin only)",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/UserDto"
                  }
                }
              }
            }
          }
        },
        "tags": [
          "Users"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    },
    "/users/{id}": {
      "get": {
        "operationId": "UsersController_findOne",
        "summary": "Get user by id",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User info",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDto"
                }
              }
            }
          }
        },
        "tags": [
          "Users"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    },
    "/auth/login": {
      "post": {
        "operationId": "AuthController_login",
        "summary": "Log in and receive a JWT token",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "JWT token returned"
          }
        },
        "tags": [
          "Auth"
        ]
      }
    },
    "/auth/register": {
      "post": {
        "operationId": "AuthController_register",
        "summary": "Register a new user",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created"
          }
        },
        "tags": [
          "Auth"
        ]
      }
    },
    "/books": {
      "get": {
        "operationId": "BookController_findAll",
        "summary": "List all books",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of books",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/BookDto"
                  }
                }
              }
            }
          }
        },
        "tags": [
          "Books"
        ]
      },
      "post": {
        "operationId": "BookController_create",
        "summary": "Create a new book (admin)",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBookDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Book created"
          }
        },
        "tags": [
          "Books"
        ]
      }
    },
    "/books/{id}": {
      "get": {
        "operationId": "BookController_findById",
        "summary": "Get a book by id",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Book detail with stock info",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BookDetailDto"
                }
              }
            }
          }
        },
        "tags": [
          "Books"
        ]
      }
    },
    "/cart/items": {
      "post": {
        "operationId": "CartController_addItem",
        "summary": "Add an item to the authenticated user's cart",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddItemDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Item added to cart"
          }
        },
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    },
    "/cart": {
      "get": {
        "operationId": "CartController_getCart",
        "summary": "Get the authenticated user's cart",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Cart contents"
          }
        },
        "tags": [
          "Cart"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    },
    "/stock": {
      "post": {
        "operationId": "StockController_create",
        "summary": "Create a stock item",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateStockDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Stock item created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StockDto"
                }
              }
            }
          }
        },
        "tags": [
          "Stock"
        ]
      }
    },
    "/stock/{id}": {
      "patch": {
        "operationId": "StockController_update",
        "summary": "Update a stock item",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateStockDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Stock item updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StockDto"
                }
              }
            }
          }
        },
        "tags": [
          "Stock"
        ]
      }
    },
    "/orders/confirm": {
      "post": {
        "operationId": "OrderController_confirm",
        "summary": "Confirm payment and finalize the order from the user cart",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConfirmOrderDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order confirmed"
          }
        },
        "tags": [
          "Orders"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    },
    "/orders/confirm-test": {
      "post": {
        "operationId": "OrderController_confirmTest",
        "summary": "DEV: fill cart and confirm order (dev only)",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Order confirmed (dev)"
          }
        },
        "tags": [
          "Orders"
        ],
        "security": [
          {
            "JWT": []
          }
        ]
      }
    }
  },
  "info": {
    "title": "LIA API",
    "description": "API documentation for LIA project",
    "version": "1.0",
    "contact": {}
  },
  "tags": [],
  "servers": [],
  "components": {
    "securitySchemes": {
      "JWT": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http"
      }
    },
    "schemas": {
      "UserDto": {
        "type": "object",
        "properties": {
          "id_usuario": {
            "type": "number",
            "example": 1
          },
          "nome": {
            "type": "string",
            "example": "Fulano"
          },
          "email": {
            "type": "string",
            "example": "fulano@example.com"
          },
          "telefone": {
            "type": "object",
            "example": "+5511999999999"
          },
          "tipo_usuario": {
            "type": "string",
            "example": "customer"
          },
          "created_at": {
            "type": "string"
          }
        },
        "required": [
          "id_usuario",
          "nome",
          "email",
          "tipo_usuario",
          "created_at"
        ]
      },
      "LoginDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "fulano@example.com"
          },
          "password": {
            "type": "string",
            "example": "strong-password"
          }
        },
        "required": [
          "email",
          "password"
        ]
      },
      "RegisterDto": {
        "type": "object",
        "properties": {
          "nome": {
            "type": "string",
            "example": "Fulano da Silva"
          },
          "email": {
            "type": "string",
            "example": "fulano@example.com"
          },
          "password": {
            "type": "string",
            "example": "strong-password"
          },
          "tipo_usuario": {
            "type": "string",
            "example": "customer"
          }
        },
        "required": [
          "nome",
          "email",
          "password"
        ]
      },
      "BookDto": {
        "type": "object",
        "properties": {
          "id_livro": {
            "type": "number",
            "example": 1
          },
          "titulo": {
            "type": "string",
            "example": "O Senhor dos Anéis"
          },
          "sinopse": {
            "type": "string",
            "example": "Sinopse..."
          },
          "editora": {
            "type": "string",
            "example": "Editora XYZ"
          },
          "ano_publicacao": {
            "type": "number",
            "example": 1954
          },
          "isbn": {
            "type": "string",
            "example": "978-xxx"
          },
          "capa_url": {
            "type": "string",
            "example": "https://..."
          }
        },
        "required": [
          "id_livro",
          "titulo"
        ]
      },
      "StockDto": {
        "type": "object",
        "properties": {
          "id_estoque": {
            "type": "number",
            "example": 1
          },
          "id_livro": {
            "type": "number",
            "example": 1
          },
          "quantidade": {
            "type": "number",
            "example": 10
          },
          "preco": {
            "type": "number",
            "example": 49.9
          },
          "condicao": {
            "type": "string",
            "example": "novo"
          },
          "created_at": {
            "type": "string"
          }
        },
        "required": [
          "id_estoque",
          "id_livro",
          "quantidade",
          "preco",
          "created_at"
        ]
      },
      "BookDetailDto": {
        "type": "object",
        "properties": {
          "id_livro": {
            "type": "number",
            "example": 1
          },
          "titulo": {
            "type": "string",
            "example": "O Senhor dos Anéis"
          },
          "sinopse": {
            "type": "string",
            "example": "Sinopse..."
          },
          "editora": {
            "type": "string",
            "example": "Editora XYZ"
          },
          "ano_publicacao": {
            "type": "number",
            "example": 1954
          },
          "isbn": {
            "type": "string",
            "example": "978-xxx"
          },
          "capa_url": {
            "type": "string",
            "example": "https://..."
          },
          "estoque": {
            "description": "Stock entries for this book",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/StockDto"
            }
          }
        },
        "required": [
          "id_livro",
          "titulo",
          "estoque"
        ]
      },
      "CreateBookDto": {
        "type": "object",
        "properties": {
          "titulo": {
            "type": "string",
            "example": "O Senhor dos Anéis"
          },
          "sinopse": {
            "type": "string",
            "example": "Sinopse..."
          },
          "editora": {
            "type": "string",
            "example": "Editora XYZ"
          },
          "ano_publicacao": {
            "type": "number",
            "example": 1954
          },
          "isbn": {
            "type": "string",
            "example": "978-xxx"
          },
          "capa_url": {
            "type": "string",
            "example": "https://..."
          }
        },
        "required": [
          "titulo"
        ]
      },
      "AddItemDto": {
        "type": "object",
        "properties": {
          "id_estoque": {
            "type": "number",
            "example": 123
          },
          "quantidade": {
            "type": "number",
            "example": 1
          }
        },
        "required": [
          "id_estoque",
          "quantidade"
        ]
      },
      "CreateStockDto": {
        "type": "object",
        "properties": {
          "id_livro": {
            "type": "number",
            "example": 1
          },
          "quantidade": {
            "type": "number",
            "example": 10
          },
          "preco": {
            "type": "number",
            "example": 49.9
          },
          "condicao": {
            "type": "string",
            "example": "novo"
          }
        },
        "required": [
          "id_livro",
          "quantidade",
          "preco"
        ]
      },
      "UpdateStockDto": {
        "type": "object",
        "properties": {
          "id_livro": {
            "type": "number",
            "example": 1
          },
          "quantidade": {
            "type": "number",
            "example": 10
          },
          "preco": {
            "type": "number",
            "example": 49.9
          },
          "condicao": {
            "type": "string",
            "example": "novo"
          }
        }
      },
      "ConfirmOrderDto": {
        "type": "object",
        "properties": {
          "id_transacao_gateway": {
            "type": "string",
            "example": "txn_123456"
          },
          "metodo_pagamento": {
            "type": "string",
            "example": "credit_card"
          },
          "valor_pago": {
            "type": "number",
            "example": 99.9
          }
        }
      }
    }
  }
}